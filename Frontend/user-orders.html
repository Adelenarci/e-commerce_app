<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Orders - My E-Commerce Store</title>
    <link rel="stylesheet" href="styles.css">
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const username = localStorage.getItem('username');
            const userId = localStorage.getItem('userId');

            if (!username || !userId) {
                alert('Please log in to view your orders.');
                window.location.href = 'user-orders.html';
                return;
            }

            document.getElementById('username').innerText = username;

            fetch(`http://localhost:5163/api/Orders/GetOrdersByUserId/${userId}`)
                .then(response => response.json())
                .then(orders => {
                    const ordersContainer = document.getElementById('orders-container');
                    ordersContainer.innerHTML = ''; // Clear existing content

                    if (orders.length === 0) {
                        ordersContainer.innerHTML = '<p>No orders found.</p>';
                        return;
                    }

                    orders.forEach(order => {
                        const orderElement = document.createElement('div');
                        orderElement.className = 'order-item';
                        orderElement.innerHTML = `
                            <p><strong>Order ID:</strong> ${order.SiparişId}</p>
                            <p><strong>Total Amount:</strong> $${order.ToplamTutar.toFixed(2)}</p>
                            <p><strong>Order Date:</strong> ${new Date(order.SiparişTarihi).toLocaleDateString()}</p>
                            <button onclick="viewOrderDetails(${order.SiparişId})">View Details</button>
                            <div id="order-details-${order.SiparişId}" class="order-details" style="display:none;"></div>
                        `;
                        ordersContainer.appendChild(orderElement);
                    });
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error fetching orders.');
                });
        });

        function viewOrderDetails(orderId) {
            const detailsContainer = document.getElementById(`order-details-${orderId}`);

            fetch(`http://localhost:5163/api/Orders/GetOrderDetails/${orderId}`)
                .then(response => response.json())
                .then(details => {
                    detailsContainer.innerHTML = ''; // Clear existing content
                    detailsContainer.style.display = 'block'; // Show the details container

                    details.forEach(detail => {
                        const detailElement = document.createElement('div');
                        detailElement.className = 'detail-item';
                        detailElement.innerHTML = `
                            <p><strong>Product ID:</strong> ${detail.ÜrünId}</p>
                            <p><strong>Quantity:</strong> ${detail.Miktar}</p>
                            <p><strong>Price:</strong> $${detail.Fiyat.toFixed(2)}</p>
                        `;
                        detailsContainer.appendChild(detailElement);
                    });
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error fetching order details.');
                });
        }
    </script>
</head>
<body>
    <header>
        <h1>User Orders</h1>
        <p id="username"></p>
    </header>
    <main>
        <section class="orders">
            <h2>Your Orders</h2>
            <div id="orders-container"></div>
        </section>
    </main>
    <footer>
        <p>&copy; 2024 My E-Commerce Store</p>
    </footer>
</body>
</html>